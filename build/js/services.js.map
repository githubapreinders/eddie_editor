{"version":3,"sources":["services.js"],"names":["app","angular","module","constant","factory","xmlTag","$http","StorageFactory","API_URL","IAF_URL","$interval","setSelectedItem","item","selectedItem","getSelectedItem","setTimerId","timerid","timerId","stopTimer","cancel","getThemes","themes","getFontSizes","fontSizes","getFormattingSettings","formattingSettings","setDataSource","string","datasource","getDataSource","getJson","get","then","data","console","info","status","thejson","JSONMONSTER","MYMONSTER","err","log","getStaticJson","loadXml","which","error","indent_size","xml","end_with_newline","js","css","preserve-newlines","DOWNLOAD_URL","UPLOAD_URL","init","getGetter","getSlots","getMySlots","myslots","sendZip","saveas","Promise","resolve","reject","cropFilter","undefined","helper","substring","lastIndexOf","length","zip","JSZip","elements","document","querySelectorAll","forEach","object","element","scope","parents","$parentNodeScope","push","$modelValue","title","filename","pop","isDirectory","folder","theslot","file","timestamp","Date","now","text","generateAsync","type","myzip","blob","Blob","saveAs","postConfig","resp","alert","finalurl","fileName","fd","FormData","append","method","url","headers","Content-type","response","getZipFromFile","loadAsync","storeZip","index","myzipfiles","async","newslotname","Math","ceil","random","getSetter","name","isParent","possibleparent","candidate","deleteAll","relativePath","myjson","i","dir","id","nodes","myobj","isLocked","sort","val1","val2","split","parentsfound","copy","j","splice","getZip","responseType","setCurrentKey","storage","$log","changeKeys","oldname","newname","thekeys","currentKey","islocked","keys","getKeys","key","switchKey","shift","getNewSlotname","createdAlias","theid","theobject","initialise","2","createKeys","indexOf","getAliases","output","thealiases","value","getCurrentKey","result","val","verifyKey","api","setter","getter","isUndefined","Error","hasOwnProperty","createAPIForKey","createSetter","createGetter","isDefined","set","message","remove","editorLoaded","_editor","completeAfter","cm","pred","getCursor","setTimeout","state","completionActive","showHint","completeSingle","CodeMirror","Pass","completeIfAfterLt","cur","getRange","Pos","line","ch","completeIfInTag","tok","getTokenAt","test","charAt","inner","innerMode","getMode","tagName","getDoc","focus","setOption","bothTags","extraKeys","'<'","'/'","' '","'='","Ctrl-Space","options","windowheight","window","innerHeight","navbarheight","getElementById","offsetHeight","ed","querySelector","style","height","validateXml","res","thexml","validateXML","setIAFURL","setCredentials","server","uname","pw","apiurl"],"mappings":"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","file":"services.js","sourcesContent":["(function(){\n\n'use strict';\n    var app = angular.module('confab');\n\n    app.constant('API_URL', \"http://localhost:3000\");\n    app.constant('DOWNLOAD_URL',\"http://localhost:3000/getzip\");\n    app.constant('UPLOAD_URL',\"http://localhost:8080/Ibis4Education/iaf/api/configurations\");\n    app.constant('IAF_URL', \"http://localhost:8080/Ibis4Education/api\");\n\n\n    app.factory('StaticDataFactory', function(xmlTag, $http, StorageFactory,API_URL,IAF_URL, $interval) \n    {\n\n        var datasource = 'pipes';\n        var timerId = 0 ;\n        var themes = [\"twilight\", \"monokai\", \"neat\"];\n        var fontSizes = [12,13,14,15,16,17,18,19,20];\n        var thejson = null;\n        var selectedItem = null;\n\n        var formattingSettings = {\n                \"indent_size\": 4,\n                \"xml\": {\n                    \"end_with_newline\": true,\n                    \"js\": {\n                        \"indent_size\": 2\n                    },\n                    \"css\": {\n                        \"indent_size\": 2\n                    }\n                },\n                \"css\": {\n                    \"indent_size\": 1\n                },\n                \"js\": {\n                 \"preserve-newlines\": true\n                }\n                };\n\n        return{\n            getJson : getJson,\n            getStaticJson : getStaticJson,\n            loadXml : loadXml,\n            setDataSource: setDataSource,\n            getDataSource: getDataSource,\n            getFormattingSettings: getFormattingSettings,\n            getThemes: getThemes,\n            getFontSizes: getFontSizes,\n            setTimerId : setTimerId,\n            stopTimer : stopTimer,\n            setSelectedItem : setSelectedItem,\n            getSelectedItem : getSelectedItem\n\n        };\n\n        function setSelectedItem(item)\n        {\n          selectedItem = item;\n        }\n\n         function getSelectedItem()\n        {\n          return selectedItem;\n        }\n\n        function setTimerId(timerid)\n        {\n          timerId = timerid;\n        }\n\n\n        function stopTimer()\n        {\n          $interval.cancel(timerId);\n        }\n\n        function getThemes()\n        {\n          return themes;\n        }\n\n        function getFontSizes()\n        {\n          return fontSizes;\n        }\n\n        function getFormattingSettings()\n        {\n          return formattingSettings;\n        }\n\n\n        function setDataSource(string)\n        {\n          datasource = string;\n        }\n\n        function getDataSource()\n        {\n          return datasource;\n        }\n\n\n        function getJson()\n        {\n\n\n\n\n          return $http.get(IAF_URL + '/getjson').then(\n            function success(data)\n            {\n                console.info(\"returning json from server with status \",data.status);\n                thejson = data.data.JSONMONSTER.MYMONSTER;\n                return data;\n            },\n            function fail(err)\n            {\n              console.log(\"server error :\", err );\n            });\n\n        }  \n\n        function getStaticJson()\n        {\n          return thejson;\n        }\n\n\n\n                function loadXml(which)\n        {\n          console.log(\"file to catch:\", which);\n          return $http.get(API_URL + '/snippets?resource=' + which ).then(function(data)\n            {\n              return data;\n            },function(error)\n            {\n              console.log(\"error loading xml\", error);\n            });\n        }\n\n    });\n\n     app.factory('ZipService', function (StorageFactory, $http ,DOWNLOAD_URL, UPLOAD_URL)\n     {\n        var myslots;\n        return {\n            init : init,\n            getSlots : getSlots,\n            getZip : getZip,\n            getZipFromFile : getZipFromFile,\n            sendZip : sendZip,\n            getMySlots : getMySlots\n        };\n\n\n        function init()\n        {\n            return StorageFactory.getGetter(\"thejson\")();\n        }\n\n        function getSlots()\n        {\n            return StorageFactory.getGetter(\"myslots\")();\n        } \n\n        function getMySlots()\n        {\n            return myslots;\n        } \n\n        function sendZip(saveas)\n        {\n                return new Promise(function(resolve, reject)\n                {\n                var zip = new JSZip();\n                var elements = document.querySelectorAll('[ui-tree-node]');\n\n\n                elements.forEach(function(item)\n                {\n                    var object = angular.element(item).scope();\n                    var parents = [];\n\n                    while(object.$parentNodeScope !== null)\n                    {\n                        parents.push(object.$parentNodeScope.$modelValue.title);\n                        object = object.$parentNodeScope;\n                    }\n\n                    var filename = \"\";\n                    while(parents.length > 0)\n                    {   \n                        filename += cropFilter(parents.pop()) + '/';\n                    }\n\n\n                    if(cropFilter(angular.element(item).scope().$modelValue.title) === 'Configuration.xml')\n                    {\n\n                                            filename = \"Ibis4Student/Configuration.xml\";\n                    }\n                    else\n                    {\n\n                                            filename =  filename + cropFilter(angular.element(item).scope().$modelValue.title) ;\n                    }\n\n                    if(angular.element(item).scope().$modelValue.isDirectory)\n                    {\n                        zip.folder(filename);\n                    }\n                    else\n                    {   \n                        var theslot = StorageFactory.getGetter(angular.element(item).scope().$modelValue.title)();\n                        zip.file(filename,StorageFactory.getGetter(theslot)());\n                    }\n                });\n                var timestamp = Date.now();\n                var text = \"configuration.version=\" + timestamp;\n                zip.file(\"BuildInfo_SC.properties\" , text);\n\n                console.log(\"Zipfile \", zip);\n\n\n                                              function cropFilter(item)\n                {\n                    if(item === undefined) return \"\";\n                    var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\n                    if(helper.length > 0)\n                    {\n                        return helper;\n                    }\n                    else\n                    {\n                        return item;\n                    }\n                }\n\n                if(saveas)\n                {\n                  console.log(\"saving as a zip file...\");\n                  zip.generateAsync({type:\"blob\"}).then(function(myzip)\n                  {\n                    var blob = new Blob([myzip],{type:\"application/zip\"});\n                    console.log(\"generated a zip...\", blob);\n                    saveAs(blob, \"configuration.zip\");\n                    resolve();\n                  });\n                }\n                else \n                {\n                  postConfig(zip, timestamp).then(function success(resp)\n                  {\n                    console.log(\"returning from postconfig\");\n                    resolve(resp);\n                  },function failure(err)\n                  {\n                    console.log(\"returning error from postconfig\");\n                    reject(err);\n                  });\n                }\n                });\n        }\n\n\n        function postConfig(zip, timestamp)\n        {\n          return new Promise(function(resolve, reject)\n          {\n            if(UPLOAD_URL === undefined || typeof UPLOAD_URL !== 'string')\n            {\n              alert(\"add a correct IAF url\");\n              return 'error';\n            }\n\n            var finalurl = UPLOAD_URL;\n            alert(finalurl);            zip.generateAsync({type:\"blob\"}).then(function(myzip)\n            {\n              var fileName = 'configuration.zip';\n              var fd = new FormData();\n\n\n                            fd.append(\"realm\", 'jdbc');\n              fd.append(\"name\", \"Ibis4Student\");\n              fd.append(\"version\", timestamp);\n              fd.append(\"encoding\", 'utf-8');\n              fd.append(\"multiple_configs\", false);\n              fd.append(\"activate_config\", true);\n              fd.append(\"automatic_reload\", true);\n              fd.append(\"file\", myzip, fileName);\n\n              console.log(\"posting to iaf\", myzip);\n              $http({method: 'POST',url:finalurl , data: fd , headers:{'Content-type': undefined}})\n              .then(function succes(response)\n              {\n                  console.info(\"returning from backend\",response);\n                  resolve (response);\n              }, function failure(err)\n              {\n                  console.info(\"returning error from backend\",err);\n                  reject(err);\n              });\n\n              });\n\n            });\n\n        }\n\n\n        function getZipFromFile(file)\n        {\n          return JSZip.loadAsync(file).then(function(zip)\n            {\n              console.log(\"loadasync from file...\", zip);\n              StorageFactory.deleteAll();\n              var myzipfiles = [];\n\n              zip.forEach(function(relativePath, file)\n              {\n                if(file.name.substring(0,2) !== '__')\n                {\n                  myzipfiles.push(file);\n                }\n              });\n\n              storeZip(0);\n\n                            function storeZip(index)\n              {\n                if(index > myzipfiles.length-1)\n                {\n                  return;\n                }\n                else\n                {\n                  if(!(myzipfiles[index].dir))\n                  {\n                    myzipfiles[index].async(\"string\").then(function resolve(data)\n                    {\n                        var newslotname = \"slot\" + Math.ceil(Math.random()*1000);\n                        StorageFactory.getSetter(myzipfiles[index].name)(newslotname);\n                        StorageFactory.getSetter(newslotname)(data);\n                        index++;\n                        storeZip(index++);\n                    });\n                  }\n                  else\n                  {\n                    index++;\n                    storeZip(index);\n                  }\n                }\n              }                              \n\n              console.log(\"zipfiles\",myzipfiles);\n              var myjson=[];\n              myslots = {};\n\n              for(var i =0 ; i< myzipfiles.length ; i++)\n              {\n                if(myzipfiles[i].dir)\n                {\n                    myjson.push({\n                    id : Math.ceil(Math.random() * 10000),  \n                    isDirectory : myzipfiles[i].dir,\n                    title : myzipfiles[i].name.substring(0,myzipfiles[i].name.length-1),\n                    nodes : []\n                    });\n                }\n                else\n                {\n                  var myobj = {\n                    id : Math.ceil(Math.random() * 10000),\n                    isDirectory : myzipfiles[i].dir,\n                    title : myzipfiles[i].name,\n                    nodes : []\n                    };\n                  myjson.push(myobj);\n                  myslots[myobj.id] = {title:myobj.title, isLocked:false};\n                }\n              }\n\n              myjson.sort(function compare(val1, val2)\n              {\n                if(val1.title.split('/').length > val2.title.split('/').length)\n                {\n                  return -1;\n                }\n                if(val1.title.split('/').length < val2.title.split('/').length)\n                {\n                  return 1;\n                }\n                return 0;\n              });\n\n                var helper = 0;\n                var parentsfound = true; \n\n\n                while(parentsfound &&  helper <100)\n                {\n                  parentsfound = false;\n                  var copy = myjson;\n\n                  for(var index = 0 ; index < myjson.length; index ++)\n                  {\n                    for(var j=0 ; j< copy.length; j++)\n                    {\n                      if(isParent(myjson[index].title, copy[j].title))\n                      {\n                        myjson[index].nodes.push(copy[j]);\n                        myjson.splice(j,1);\n                        parentsfound = true;\n                        break;\n                      }\n                    }\n                    if(parentsfound)\n                    {\n                      break;\n                    }\n                  }\n                  helper ++;\n                }\n\n\n\n                function isParent(possibleparent, candidate)\n                {\n                  if(possibleparent === candidate)\n                  {\n                    return false;\n                  }\n                  var index = candidate.lastIndexOf('/');\n                  if(candidate.substring(0,index) === possibleparent)\n                  {\n                    return true;\n                  }\n                  else\n                  {\n                    return false;\n                  }\n                }\n\n                console.log(\"generated json out of zip:\\n\",myjson);\n\n                StorageFactory.getSetter('thejson')(myjson);\n                StorageFactory.getSetter('myslots')(myslots);  \n                return(myjson); \n\n              });\n        }\n\n\n\n\n\n\n        function getZip()\n        {\n\n          return $http({method:\"GET\", url:DOWNLOAD_URL, responseType:'arraybuffer'}).then(function success(resp)\n          {\n            return new Promise(function (resolve, reject)\n            {\n            JSZip.loadAsync(resp.data).then(function(zip)\n            {\n              console.log(\"loadasync...\", zip);\n              StorageFactory.deleteAll();\n              var myzipfiles = [];\n\n              zip.forEach(function(relativePath, file)\n              {\n                if(file.name.substring(0,2) !== '__')\n                {\n                  myzipfiles.push(file);\n                }\n              });\n\n              storeZip(0);\n\n                            function storeZip(index)\n              {\n                if(index > myzipfiles.length-1)\n                {\n                  return;\n                }\n                else\n                {\n                  if(!(myzipfiles[index].dir))\n                  {\n                    myzipfiles[index].async(\"string\").then(function resolve(data)\n                    {\n                        var newslotname = \"slot\" + Math.ceil(Math.random()*1000);\n                        StorageFactory.getSetter(myzipfiles[index].name)(newslotname);\n                        StorageFactory.getSetter(newslotname)(data);\n                        index++;\n                        storeZip(index++);\n                    });\n                  }\n                  else\n                  {\n                    index++;\n                    storeZip(index);\n                  }\n                }\n              }                              \n\n              console.log(\"zipfiles\",myzipfiles);\n              var myjson=[];\n              myslots = {};\n\n              for(var i =0 ; i< myzipfiles.length ; i++)\n              {\n                if(myzipfiles[i].dir)\n                {\n                    myjson.push({\n                    id : Math.ceil(Math.random() * 10000),  \n                    isDirectory : myzipfiles[i].dir,\n                    title : myzipfiles[i].name.substring(0,myzipfiles[i].name.length-1),\n                    nodes : []\n                    });\n                }\n                else\n                {\n                  var myobj = {\n                    id : Math.ceil(Math.random() * 10000),\n                    isDirectory : myzipfiles[i].dir,\n                    title : myzipfiles[i].name,\n                    nodes : []\n                    };\n                  myjson.push(myobj);\n                  myslots[myobj.id] = {title:myobj.title, isLocked:false};\n                }\n              }\n\n              myjson.sort(function compare(val1, val2)\n              {\n                if(val1.title.split('/').length > val2.title.split('/').length)\n                {\n                  return -1;\n                }\n                if(val1.title.split('/').length < val2.title.split('/').length)\n                {\n                  return 1;\n                }\n                return 0;\n              });\n\n                var helper = 0;\n                var parentsfound = true; \n\n\n                while(parentsfound &&  helper <100)\n                {\n                  parentsfound = false;\n                  var copy = myjson;\n\n                  for(var index = 0 ; index < myjson.length; index ++)\n                  {\n                    for(var j=0 ; j< copy.length; j++)\n                    {\n                      if(isParent(myjson[index].title, copy[j].title))\n                      {\n                        myjson[index].nodes.push(copy[j]);\n                        myjson.splice(j,1);\n                        parentsfound = true;\n                        break;\n                      }\n                    }\n                    if(parentsfound)\n                    {\n                      break;\n                    }\n                  }\n                  helper ++;\n                }\n\n\n\n                function isParent(possibleparent, candidate)\n                {\n                  if(possibleparent === candidate)\n                  {\n                    return false;\n                  }\n                  var index = candidate.lastIndexOf('/');\n                  if(candidate.substring(0,index) === possibleparent)\n                  {\n                    return true;\n                  }\n                  else\n                  {\n                    return false;\n                  }\n                }\n\n                console.log(\"generated json out of zip:\\n\",myjson);\n\n                StorageFactory.setCurrentKey(myslots[0]);\n                StorageFactory.getSetter('thejson')(myjson);\n                StorageFactory.getSetter('myslots')(myslots);  \n                resolve(myjson); \n\n              });\n\n            });\n\n        });\n\n      }\n\n     });\n\n\n\n\n    app.factory('StorageFactory',['storage', '$log', function(storage, $log)\n    {\n      var api = {};\n      var thekeys;\n      var thealiases = [\"file1\"];\n      var currentKey = \"slot1\";\n      var myaliases;\n\n            return {\n        getSetter : getSetter,\n        getGetter : getGetter,\n        verifyKey : verifyKey,\n        createAPIForKey : createAPIForKey,\n        createSetter : createSetter,\n        createGetter : createGetter,\n        getAliases : getAliases,\n        switchKey : switchKey,\n        setCurrentKey : setCurrentKey,\n        getCurrentKey : getCurrentKey,\n        getNewSlotname : getNewSlotname,\n        initialise : initialise,\n        deleteAll : deleteAll,\n        changeKeys : changeKeys\n      };\n\n      function changeKeys(oldname, newname)\n      {\n        console.log(oldname , newname,\"\\n\", thekeys, currentKey, \"\\n\");\n        var index = -1;\n        var islocked = \"\";\n        for(var i= 0 ; i< thekeys.length ; i++)\n        {\n          if(thekeys[i].title === oldname)\n          {\n            index = i;\n            islocked = thekeys[i].isLocked;\n          }\n        }\n        if(index !== -1)\n        {\n          if(currentKey.title === oldname)\n          {\n            currentKey.title = newname;\n          }\n          thekeys[index].title = newname;\n        }\n        console.log(\"after change: \", thekeys,\"\\n\", currentKey, \"\\n\");\n      }\n\n      function deleteAll()\n      {\n        var keys = storage.getKeys();\n        keys.forEach(function(key)\n        {\n          if(key !== 'IAF_URL')\n          {\n            getSetter(key)();\n          }\n        });\n      }\n\n      function switchKey()\n      {\n          var helper = thekeys.shift();\n          thekeys.push(helper);\n          currentKey = thekeys[0]\n          return thekeys[0];\n      }\n\n      function removeKey(itsAlias)\n      {\n        var index;\n        for(var i =0 ; i< thekeys.length; i++)\n        {\n          if(thekeys[i].title === itsAlias)\n          {\n              index = i;\n          }\n        }\n        thekeys.splice(index, 1);\n\n        if(currentKey.title === itsAlias)\n        {\n          currentKey = thekeys[0];\n        }\n      }\n\n\n\n\n      function getNewSlotname(createdAlias, theid)\n      {\n        console.log(\"id \", theid);\n        var newslotname = \"slot\" + Math.ceil(Math.random()*1000);\n        var theobject = { \"title\" : createdAlias, \"isLocked\" : false };\n        thekeys.push(theobject);\n        getSetter(newslotname)('<?xml version=\"1.0\" encoding=\"UTF-8\"?>');\n        getSetter(createdAlias)(newslotname);\n        var helper = getGetter(\"myslots\")();\n        helper[theid] = theobject;\n        getSetter(\"myslots\")(helper);\n        return newslotname;\n      }\n\n      function initialise()\n      {\n        if(storage.getKeys().length === 0)\n        {\n          getSetter(\"slot1\")(\" start here...\");\n          getSetter(\"file1\")(\"slot1\");\n          var thejson = [\n                          {\n                            \"id\": 1,\n                            \"title\": \"dir1\",\n                            \"isDirectory\": true,\n                            \"nodes\": [\n                              {\n                                \"id\": 2,\n                                \"title\": \"file1\",\n                                \"isDirectory\": false,\n                                \"isLocked\": false,\n                                \"nodes\": []\n                              }\n                            ]\n                          }\n                        ];\n          var myslots = { 2 : {\"title\":\"file1\",isLocked:false} };              \n          getSetter(\"thejson\")(thejson);\n          getSetter(\"myslots\")(myslots);\n          thekeys = createKeys([\"file1\"]);\n        }\n        else\n        {\n          var helper = storage.getKeys();\n          if(helper.indexOf(\"thejson\") > -1)\n          {\n              helper.splice(helper.indexOf(\"thejson\"),1);\n          }  \n          if(helper.indexOf(\"myslots\") > -1)\n          {\n              helper.splice(helper.indexOf(\"myslots\"),1);\n          } \n          if(helper.indexOf(\"IAF_URL\") > -1)\n          {\n              helper.splice(helper.indexOf(\"IAF_URL\"),1);\n          } \n\n          thekeys = createKeys(helper); \n        }\n        currentKey = thekeys[0];\n      }\n\n\n      function getAliases()\n      {\n        var output = [];\n\n        thealiases.forEach(function(value)\n        {\n          output.push(getGetter(value)());\n        });\n\n      return output;  \n      }\n\n\n      function setCurrentKey(key)\n      {\n       console.log(\"set currentkey::\", key); \n        currentKey = key;\n      }\n\n      function getCurrentKey()\n      {\n        return currentKey;\n      }      \n\n\n      function createKeys(helper)\n      {\n        var result = [];\n        helper.forEach(function(val)\n        {\n          if(val.substring(0,4) !== 'slot' )\n          {\n            result.push({\"title\" : val, \"isLocked\" : false});\n          }\n        });\n        return result;\n      }\n\n      function getSetter(key)\n      {\n        verifyKey(key);\n        return api[key].setter;\n      }\n      function getGetter(key)\n      {\n        verifyKey(key);\n        return api[key].getter;\n      }\n\n      function verifyKey(key)\n      {\n        if(!key || angular.isUndefined(key))\n        {\n          throw new Error(\"Key[ \" + key + \" ] is invalid\");\n        }\n\n        if(!api.hasOwnProperty(key))\n        {\n          createAPIForKey(key);\n        }\n\n\n      }\n\n      function createAPIForKey(key)\n      {\n        var setter = createSetter(key);\n        var getter = createGetter(key);\n        api[key] = \n        {\n          setter : setter,\n          getter : getter\n        };\n      }\n\n      function createSetter(key)\n      {\n        return function(value)\n        {\n          if(angular.isDefined(value))\n          {\n            try\n            {\n              storage.set(key, value);\n            }\n            catch(error)\n            {\n              $log.info('[StorageFactory]' + error.message);\n            }\n          }\n          else\n          {\n            storage.remove(key);\n          }\n        };\n      }\n\n      function createGetter(key)\n      {\n        return function()\n        {\n          var value = storage.get(key);\n          if(value === null)\n          {\n            value = undefined;\n            var setter = api[key].setter;\n            setter(value);\n          }\n          return value;\n        }\n      }\n    }]);\n    app.factory('EditorFactory', function()\n    {\n    var editor = null;  \n\n            return {\n        editorLoaded : editorLoaded\n      };\n\n      function editorLoaded(_editor)\n      {\n                var _doc = _editor.getDoc();\n                _editor.focus();\n                _editor.setOption('lineNumbers', true);\n                _editor.setOption('lineWrapping', true);\n                _editor.setOption('mode', 'xml');\n                _editor.setOption('beautify', 'true');\n                _editor.setOption('theme', 'twilight');\n                _editor.setOption('foldGutter', true);\n                _editor.setOption('gutters',[ \"CodeMirror-linenumbers\",\"CodeMirror-foldgutter\"]);\n                _editor.setOption('matchTags', {bothTags: true});\n                var extraKeys =  {\n                          \"'<'\": completeAfter,\n                          \"'/'\": completeIfAfterLt,\n                          \"' '\": completeIfInTag,\n                          \"'='\": completeIfInTag,\n                          \"Ctrl-Space\": \"autocomplete\"\n                                };\n                _editor.setOption('extraKeys', extraKeys);\n\n                console.log(\"editor loaded;\",_editor.options);\n\n                var windowheight = window.innerHeight;\n                var navbarheight = document.getElementById('mynavbar').offsetHeight;\n                var ed = document.querySelector('.CodeMirror');\n                ed.style.height = (windowheight - navbarheight) + 'px'; \n                console.log(\"window, navbar, editor:\", windowheight, navbarheight, ed.style.height);\n\n                function completeAfter(cm, pred) \n                {\n                    var cur = cm.getCursor();\n                    if (!pred || pred()) setTimeout(function() \n                    {\n                        if (!cm.state.completionActive)\n                        cm.showHint({completeSingle: false});\n                    }, 100);\n                    return CodeMirror.Pass;\n                }\n\n                function completeIfAfterLt(cm) \n                {\n                    return completeAfter(cm, function() \n                    {\n                        var cur = cm.getCursor();\n                        return cm.getRange(CodeMirror.Pos(cur.line, cur.ch - 1), cur) == \"<\";\n                    });\n                }\n\n                function completeIfInTag(cm) \n                {\n                return completeAfter(cm, function() \n                {\n                    var tok = cm.getTokenAt(cm.getCursor());\n                    if (tok.type == \"string\" && (!/['\"]/.test(tok.string.charAt(tok.string.length - 1)) || tok.string.length == 1)) return false;\n                    var inner = CodeMirror.innerMode(cm.getMode(), tok.state).state;\n                    return inner.tagName;\n                });\n\n              }\n              return _editor;\n            }\n\n    });\n    app.factory('ValidationFactory', function(StorageFactory, $http, API_URL)\n    {\n      return {\n        validateXml : validateXml\n      };\n\n      function validateXml()\n      {\n\n          return $http.get(API_URL + '/validate').then(function succes(res)\n          {\n            var thexml = StorageFactory.getGetter(StorageFactory.getCurrentKey())();\n            console.log(\"xsd:\\n\",  res);\n            console.log(\"xml:\\n\", typeof thexml);\n            var message = validateXML(thexml, res.data);\n            return message;\n          },\n          function fail(err)\n          {\n            console.log(\"failure....\", err);\n            return err;\n          });  \n      }\n    });\n    app.factory('IafFactory', function($http, StorageFactory, UPLOAD_URL)\n    {\n\n          var uname = null;\n    var pw = null;\n      return{\n        postConfig : postConfig,\n        setCredentials : setCredentials,\n        setIAFURL : setIAFURL\n      };\n\n      function setIAFURL()\n      {\n        UPLOAD_URL = StorageFactory.getGetter('UPLOAD_URL')();\n      }\n\n      function postConfig(zip)\n      {\n        return new Promise(function(resolve, reject)\n        {\n          var finalurl = UPLOAD_URL;\n          alert(finalurl);\n        zip.generateAsync({type:\"blob\"}).then(function(myzip)\n        {\n          var fileName = 'configuration.zip';\n          var fd = new FormData();\n          fd.append(\"realm\", 'jdbc');\n          fd.append(\"name\", \"Ibis4Student\");\n          fd.append(\"version\", 1);\n          fd.append(\"encoding\", 'utf-8');\n          fd.append(\"multiple_configs\", false);\n          fd.append(\"activate_config\", true);\n          fd.append(\"automatic_reload\", true);\n          fd.append(\"file\", myzip, fileName);\n\n\n          return new Promise(function(resolve, reject)\n          {\n             console.log(\"posting to iaf\", myzip);\n              return $http({method: 'POST',url:finalurl , data: fd , headers:{'Content-type': undefined}}\n                  ).then(function succes(response)\n                  {\n                      console.info(\"returning from backend\",response);\n                      resolve (response);\n                  }, function failure(response)\n                  {\n                      console.info(\"returning error from backend\",response);\n                      reject(response);\n                  });\n                })            \n          });\n        resolve();\n        })\n\n\n\n      }\n\n      function setCredentials(server, uname, pw)\n      {\n        console.log(\"server\",server, uname, pw);\n\n               if (server)\n        {\n          UPLOAD_URL = server;\n          console.log(\"upload url\", UPLOAD_URL, typeof(IAF_URL));\n          StorageFactory.getSetter('UPLOAD_URL')(server);\n        }\n        uname = uname;\n        pw = pw;\n\n        return{\n          apiurl:server,\n          uname : uname,\n          pw : pw\n        };\n      }\n    });\n\n})();   "],"sourceRoot":"/source/"}